const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i={};for(var s=0;s<t.length;s++)i[t[s]]=s;const e=function(...i){return i.map((i=>{for(var s="";s=t[63&i]+s,0!=(i>>>=6););return s})).join("")},a=function(t){for(var s=0,e=t.split(""),a=0;a<e.length;a++)s=(s<<6)+i[e[a]];return s},r=function(t,i){let s=i.replace(new RegExp(`[${t.replace(/[^a-zA-Z0-9]/g,"")}]`,"gi"),"1").replace(/[^1]/g,0);return e(parseInt(s,2)).padStart(e(2^i.length).length,"0")},n=function(t,i){let s=`string: "${t}" | ${i} = `,e=a(t).toString(2).padStart(i.length,"0").split("").map(((t,s)=>"1"===t?i[s]:"")).join("");return console.log(`${s}"${e}"`),e},c=function(...t){return e(parseInt(t.reverse().map((t=>t?1:0)).join(""),2))},o=function(t){let i=`boolean: "${t}" = `,s=a(t).toString(2).split("").reverse().map((t=>"1"===t));return console.log(`${i}"${s}"`),s},h=function(...t){return t.map((t=>{if(t>63)throw new Error("Numbers in configuration must be < 64.");return e(t)})).join("")},l=function(t){let i=`number: "${t}" = `,s=a(t);return console.log(`${i}"${s}"`),s};var u,k,m,d,f,p;(k=u||(u={}))[k.None=0]="None",k[k.Alternate=1]="Alternate",k[k.Same=2]="Same",(d=m||(m={}))[d.None=0]="None",d[d.Equal=1]="Equal",d[d.Asc=2]="Asc",d[d.Desc=3]="Desc",(p=f||(f={}))[p.Any=0]="Any",p[p.Touching=1]="Touching",p[p.Overlaying=2]="Overlaying",p[p.Underlaying=3]="Underlaying";class g{constructor(t){if(this.suit=!1,this.hasJoker=!1,this.useFreecells=!1,this.fromStack=0,this.color=0,this.rank=0,this.count=0,this.total=0,this.countGT=!1,this.countLT=!1,this.totalGT=!1,this.totalLT=!1,!t||"boolean"==typeof t)return this;if("string"==typeof t){let i=t.split("");[this.suit,this.hasJoker,this.useFreecells]=o(i[0]),[this.countLT,this.countGT,this.totalLT,this.totalGT]=o(i[1]),this.color=l(i[2]),this.rank=l(i[3]),this.count=l(i[4]),this.total=l(i[5]),this.fromStack=l(i[6])}else Object.assign(this,t);return this}toString(){return[c(this.suit,this.hasJoker,this.useFreecells),c(this.countLT,this.countGT,this.totalLT,this.totalGT),h(this.color,this.rank,this.count,this.total,this.fromStack)].join("")}}class y{constructor(t){return this.conf=new g,t&&"boolean"!=typeof t?(t instanceof y?Object.assign(this,t):this.conf=new g(t),this):this}test(t,i){let s=!!i,e=!!s&&i.topCard;if(s&&!e&&(this.conf.suit||this.conf.color||this.conf.rank))return 0;if(Array.isArray(t)||(t=[t]),this.conf.total){let i=t.reduce(((t,i)=>t+i.value),0);if(this.conf.totalLT&&this.conf.total>=i);else if(this.conf.totalGT&&this.conf.total<=i);else if(this.conf.total!==i)return 0}if(this.conf.count)if(this.conf.countLT&&this.conf.count>=t.length);else if(this.conf.countGT&&this.conf.count<=t.length);else if(this.conf.count!==t.length)return 0;if(this.conf.useFreecells&&!(t.length-1<=i.freecellStacks.filter((t=>t.isEmpty)).length))return 0;if(this.conf.hasJoker&&!t.filter((t=>t.isJoker)).length)return 0;if(this.conf.suit){let i=e?e.suit:t[0].suit;if(t.filter((t=>t.suit===i)).length!==t.length)return 0}if(this.conf.color){let i=e?e.color:t[0].color;if(2===this.conf.color&&t.length===t.filter((t=>t.color===i)).length);else if(t.length!==t.filter(((t,s)=>s%2?t.color===i:t.color&&t.color!==i)).length)return 0}if(this.conf.rank){let i=e?e.rank:"";if(1===this.conf.rank){if(t.filter((t=>t.rank===i)).length!==t.length)return 0}else if(2===this.conf.rank){if(i+=t.map((t=>t.rank)).join(""),!b.match(i))return 0}else if(3===this.conf.rank&&(i=t.map((t=>t.rank)).reverse().join("")+i,!b.match(i)))return 0}return s?i.conf.matchPriority:1}toString(){return this.conf.toString()}}const b="A23456789TJQK";class w{constructor(t){if(this.empty="23456789TJQKA",this.init=0,this.facedown=0,this.deal=0,this.limitCards=0,this.limitAvailable=1,this.limitVisible=0,this.canPut=!0,this.canGet=!0,this.horizontal=!1,this.isFreecell=!1,this.showEmpty=!0,this.matchPriority=1,this.match=[],this.complete=[],!t||"boolean"==typeof t)return this;if("string"==typeof t){let i=t.split(";");this.empty=n(i[0],"23456789TJQKA"),[this.canPut,this.canGet,this.horizontal,this.isFreecell,this.showEmpty]=o(i[1]),[this.init,this.facedown,this.deal,this.limitCards,this.limitAvailable,this.limitVisible,this.matchPriority]=i[2].split("").map(l),this.match=i[3].split(",").map((t=>new y(t))),this.complete=i[4].split(",").map((t=>new y(t)))}else t.deal&&!t.canPut&&(t.canPut=!1),t.match&&(t.match=Array.isArray(t.match)?t.match.map((t=>new y(t))):[new y(t.match)]),t.complete&&(t.complete=Array.isArray(t.complete)?t.complete.map((t=>new y(t))):[new y(t.complete)]),Object.assign(this,t);return this}toString(){return[r(this.empty,"23456789TJQKA"),c(this.canPut,this.canGet,this.horizontal,this.isFreecell,this.showEmpty),h(this.init,this.facedown,this.deal,this.limitCards,this.limitAvailable,this.limitVisible,this.matchPriority),this.match.join(","),this.complete.join(",")].join(";")}}class A{constructor(t,i=0){this._stack=[],this._facedown=0,this.index=0,this.isDeck=!1,this.initialized=!1,this.stacksOverlayed=[],this.stacksOverlaying=[],this.freecellStacks=[],this.conf=new w;let s=new w(t);return Object.assign(this.conf,s),Number.isInteger(i)&&(this.index=i),this}get stack(){return this._stack}set stack(t){this._stack=t}get isEmpty(){return 0===this._stack.length}get length(){return this._stack.length}get firstVisible(){return this.conf.limitVisible?Math.max(this.stack.length-this.conf.limitVisible,0):0}get maxHeight(){return this.conf.horizontal||1===this.conf.limitCards||1===this.conf.limitVisible?1:this.conf.limitCards||this.conf.limitVisible?this.conf.limitCards||this.conf.limitVisible:this.conf.canPut||this.conf.deal?14:this.conf.init||1}get maxWidth(){return this.conf.horizontal&&1!==this.conf.limitCards&&1!==this.conf.limitVisible?this.conf.limitCards||this.conf.limitVisible?this.conf.limitCards||this.conf.limitVisible:this.conf.canPut||this.conf.deal?52:this.conf.init||1:1}get topCard(){return this.stack[this.length-1]||void 0}get isComplete(){return this.conf.complete.reduce(((t,i)=>t&&!!i.test(this.stack)),!0)}get isBlocked(){return this.stacksOverlaying.reduce(((t,i)=>t||!i.isEmpty),!1)}isTouching(t){return this.isOverlaying(t)||this.isOverlayedBy(t)}isOverlaying(t){return this.stacksOverlayed.map((t=>t.index)).includes(t)}isOverlayedBy(t){return this.stacksOverlaying.map((t=>t.index)).includes(t)}reset(){this.stack=[],this.initialized=!1}push(t){Array.isArray(t)||(t=[t]),this._stack=[...this._stack,...t]}look(t=1){return"number"==typeof t||(t="string"==typeof t?parseInt(t):Array.isArray(t)?t.length:1),this._stack.slice(this.length-t)}pull(t=1){return"number"==typeof t||(t="string"==typeof t?parseInt(t):Array.isArray(t)?t.length:1),this._stack.splice(this.length-t,t)}truncate(t){"number"==typeof t||"string"==typeof t&&(t=parseInt(t));let i=this.length-t;return this.pull(i)}getCardDepth(t){if("number"==typeof t)return this.length-t;let i=Array.isArray(t)?this.stack.indexOf(t[0]):this.stack.indexOf(t);return this.length-i}getCard(t){return this.stack[this.length-t]}toString(){return this.stack.join(",")}wants(t){return this.conf.canPut?(Array.isArray(t)||(t=[t]),this.stack.join("").match(RegExp(t.join("")+"$"))?0:this.isEmpty&&this.conf.empty.match(t[0].rank)&&(!this.conf.limitCards||t.length<=this.conf.limitCards)?this.conf.matchPriority:this.conf.limitCards&&this.length+t.length>this.conf.limitCards?0:this.conf.match?Math.max(...this.conf.match.map((i=>i.test(t,this)))):0):0}}class S{constructor(t="",i=0){let s,e;this.char="",this.suit="",this.color="",this.suitName="",this.rank="",this.text="<blank>",this.value=0,this.isJoker=!1,this.facedown=!1,t?t.match(/\d/)?(s=C.find((i=>i.char===t)),Object.assign(this,s),this.isJoker=!0,this.rank=t,this.suitName="joker",this.text="Joker",this.value=0):(s=N.find((i=>i.char===t)),Object.assign(this,s),this.text=this.rank.replace("T","10"),this.value=b.indexOf(this.rank)+1):e=!0,this.facedown=!!e,this.id=i}flip(){return this.facedown=!this.facedown,this}toString(){return this.isJoker?"üÉè":`${this.rank}${this.suit}`}}class v{constructor(t,i,s){this.char="",this.suit="",this.color="",this.suitName="",this.rank="",this.text="<blank>",this.value=0,this.isJoker=!1,this.facedown=!1,Object.assign(this,t),this.cardDepth=i,this.stackIndex=s}toString(){return this.isJoker?"üÉè":`${this.rank}${this.suit}`}}const N=[{suit:"‚ô£",color:"black",suitName:"clubs",rank:"A",char:"a"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"2",char:"b"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"3",char:"c"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"4",char:"d"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"5",char:"e"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"6",char:"f"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"7",char:"g"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"8",char:"h"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"9",char:"i"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"T",char:"j"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"J",char:"k"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"Q",char:"l"},{suit:"‚ô£",color:"black",suitName:"clubs",rank:"K",char:"m"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"A",char:"n"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"2",char:"o"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"3",char:"p"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"4",char:"q"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"5",char:"r"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"6",char:"s"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"7",char:"t"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"8",char:"u"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"9",char:"v"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"T",char:"w"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"J",char:"x"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"Q",char:"y"},{suit:"‚ô•",color:"red",suitName:"hearts",rank:"K",char:"z"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"A",char:"A"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"2",char:"B"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"3",char:"C"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"4",char:"D"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"5",char:"E"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"6",char:"F"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"7",char:"G"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"8",char:"H"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"9",char:"I"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"T",char:"J"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"J",char:"K"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"Q",char:"L"},{suit:"‚ô¶",color:"red",suitName:"diamonds",rank:"K",char:"M"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"A",char:"N"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"2",char:"O"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"3",char:"P"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"4",char:"Q"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"5",char:"R"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"6",char:"S"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"7",char:"T"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"8",char:"U"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"9",char:"V"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"T",char:"W"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"J",char:"X"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"Q",char:"Y"},{suit:"‚ô†",color:"black",suitName:"spades",rank:"K",char:"Z"}],C=[{suit:"üÉè",suitName:"joker",rank:"1",char:"1"},{suit:"üÉè",suitName:"joker",rank:"2",char:"2"},{suit:"üÉè",suitName:"joker",rank:"3",char:"3"},{suit:"üÉè",suitName:"joker",rank:"4",char:"4"},{suit:"üÉè",suitName:"joker",rank:"5",char:"5"},{suit:"üÉè",suitName:"joker",rank:"6",char:"6"},{suit:"üÉè",suitName:"joker",rank:"7",char:"7"},{suit:"üÉè",suitName:"joker",rank:"8",char:"8"},{suit:"üÉè",suitName:"joker",rank:"9",char:"9"}];class j{constructor(t){if(this.ranks=b,this.suits="chds",this.jokers=0,this.decks=1,!t)return this;if("string"==typeof t){let i=n(t.slice(0,3),b+"chds");this.ranks=i.replace(/chds/g,"").toLowerCase(),this.suits=i.replace(/A23456789TJQK/g,""),this.jokers=l(t.slice(3,4).toString()),this.decks=l(t.slice(4,5).toString())}else Object.assign(this,t),this.suits=this.suits.toLowerCase()}toString(){return[r(this.ranks+this.suits,b+"chds"),h(this.jokers),h(this.decks)].join("")}}class x{constructor(t){if(this._deck=[],this.stack=[],this.index=-1,this.isDeck=!0,this.cycles=1,this.maxHeight=1,this.maxWidth=1,this.initialized=!1,this.isShuffled=!1,this.freecellStacks=[],this.stacksOverlayed=[],this.stacksOverlaying=[],"string"==typeof t&&t.match(/^[a-zA-Z1-9]{6,}$/))this.deck=t.split("");else if(Array.isArray(t))this.deck=t;else{this.conf=new j(t);let i=[...N.filter((t=>this.ranks.match(t.rank)&&this.suits.match(t.suitName[0]))).map((t=>t.char)),...Array.from({length:this.conf.jokers},((t,i)=>i+1)).map((t=>t.toString()))];this.deck=new Array(this.conf.decks).fill(i).flat(),this.isShuffled||this.shuffle()}return this}get deck(){return this._deck}set deck(t){if(!Array.isArray(t))throw new Error("Invalid deck given");let i=t.map((t=>"string"==typeof t?t:t.id));if(this._deck=t.map(((t,i)=>new S(t,i))),this.stack=[...this._deck],!this.conf){let t=this.deck.filter((t=>t.char.match(/[a-zA-Z]/))).map((t=>t.rank)).join(""),s=b.split("").filter((i=>t.match(i))).join(""),e=t[0],a=N.find((t=>t.char===e)).rank,r=N.filter((t=>t.rank===a)).map((t=>t.suitName[0])),n=t.length-t.replace(RegExp(e,"g"),"").length,c=i.filter((t=>t.match(/\d/))).length;this.conf=new j({decks:n,ranks:[...new Set(s)].join(""),suits:[...new Set(r)].join(""),jokers:c?c/n:0})}}get decks(){return this.conf.decks}get suits(){return this.conf.suits}get ranks(){return this.conf.ranks}get isEmpty(){return 0===this.stack.length}get topCard(){return this.stack[0]}get isBlocked(){return this.stacksOverlaying.reduce(((t,i)=>t||!i.isEmpty),!1)}reset(){this.initialized=!1,this.cycles=1,this.stack=[...this.deck.map((t=>(t.facedown=!1,t)))]}isTouching(t){return this.isOverlaying(t)||this.isOverlayedBy(t)}isOverlaying(t){return this.stacksOverlayed.map((t=>t.index)).includes(t)}isOverlayedBy(t){return this.stacksOverlaying.map((t=>t.index)).includes(t)}shuffle(){let t=this._deck.length;for(;t;)this._deck.push(this._deck.splice(Math.floor(Math.random()*t),1)[0]),t-=1;return this.reset(),this}push(t){Array.isArray(t)||(t=[t]),this.stack=[...t,...this.stack]}pull(t=1){return"number"==typeof t||(t="string"==typeof t?parseInt(t):Array.isArray(t)?t.length:1),this.stack.splice(0,t)}look(t=1){return"number"==typeof t||(t="string"==typeof t?parseInt(t):Array.isArray(t)?t.length:1),this.stack.slice(0,t)}truncate(t){"number"==typeof t||"string"==typeof t&&(t=parseInt(t));let i=this.length-t;return this.pull(i)}getCardDepth(t){if("number"==typeof t)return this.length-t;let i=Array.isArray(t)?this.stack.indexOf(t[0]):this.stack.indexOf(t);return this.length-i}getCard(t){return this.stack[this.length-t]}toString(){return this.deck.map((t=>t.id)).join("")}wants(){return 0}get firstVisible(){return this.stack.length-1}get length(){return this.stack.length}}let O={};function D(t){if(O[t.name])throw new Error(`Duplicate name ${t.name}`);O[t.name]=t,t.name===t.family?O[t.name].variants=[]:O[t.family]&&O[t.family].variants.push(t)}D({name:"klondike",family:"klondike",title:"Klondike",stackConfig:[{empty:"A",limitVisible:1,match:{suit:!0,rank:m.Asc,count:1},complete:{count:13,suit:!0}},{empty:"K",match:{color:u.Alternate,rank:m.Desc},limitAvailable:0,init:1},{empty:"K",match:{color:u.Alternate,rank:m.Desc},limitAvailable:0,init:2,facedown:1},{empty:"K",match:{color:u.Alternate,rank:m.Desc},limitAvailable:0,init:3,facedown:2},{empty:"K",match:{color:u.Alternate,rank:m.Desc},limitAvailable:0,init:4,facedown:3},{empty:"K",match:{color:u.Alternate,rank:m.Desc},limitAvailable:0,init:5,facedown:4},{empty:"K",match:{color:u.Alternate,rank:m.Desc},limitAvailable:0,init:6,facedown:5},{empty:"K",match:{color:u.Alternate,rank:m.Desc},limitAvailable:0,init:7,facedown:6},{deal:3,limitAvailable:1,limitVisible:3,horizontal:!0}],layout:"0000-D8,1234567"}),D(Object.assign({},O.klondike,{name:"klondike-vegas",title:"Vegas",limitCycles:3})),D(Object.assign({},O["klondike-vegas"],{name:"klondike-vegas-strict",title:"Vegas Strict (1 undo)",limitUndo:1})),D(Object.assign({},O.klondike,{name:"klondike-one",family:"klondike",title:"Draw One",stackConfig:[...O.klondike.stackConfig].map((t=>{t.deal&&(t=Object.assign({},t,{deal:1}))}))})),D({name:"freecell",family:"freecell",title:"Freecell",stackConfig:[{limitCards:1,isFreecell:!0},{empty:"A",limitVisible:1,matchPriority:3,match:{count:1,suit:!0,rank:m.Asc},complete:{count:13,suit:!0}},{init:50,matchPriority:2,limitAvailable:0,match:{color:u.Alternate,rank:m.Desc,useFreecells:!0}}],layout:"0000 1111,22222222"}),D({name:"pyramid",family:"pyramid",title:"Pyramid",overlayRows:!0,showEmpty:!1,multiSelect:!0,limitCycles:1,deckConfig:{jokers:2},stackConfig:[{empty:"",canPut:!1,init:1,limitCards:1,complete:{count:0},showEmpty:!1},{empty:"",deal:1,canPut:!1,limitAvailable:5,limitVisible:5,horizontal:!0},{canGet:!1,empty:"",limitVisible:1,match:[{total:13},{hasJoker:!0}]}],layout:"0,00,000,0000,00000,000000,0000000",footer:"_D 1 2_"}),D(Object.assign({},O.pyramid,{name:"pyramid-extra",family:"pyramid",title:"Extra",deckConfig:{jokers:3},layout:"0,00,000,0000,00000,000000,0000000,00000000"})),D(Object.assign({},O.pyramid,{name:"pyramid-exact-draw-three",family:"pyramid",title:"Exact, Draw 3",stackConfig:[{empty:"",canPut:!1,init:1,limitCards:1,complete:{count:0},showEmpty:!1},{deal:!0,limitAvailable:1,limitVisible:5,horizontal:!0},{canGet:!1,empty:"",limitVisible:1,match:[{count:2,countLT:!0,total:13},{count:2,countLT:!0,hasJoker:!0}]}],footer:"D 1 1 1 2"})),D({name:"golf",family:"golf",title:"Golf",stackConfig:[{init:5,canPut:!1},{limitVisible:1,limitAvailable:1,deal:1,canGet:!0,canPut:!0,match:[{count:1,rank:m.Asc},{count:1,rank:m.Desc}]}],layout:"0000000",footer:"_D 1_",limitCycles:1}),D({name:"spider",family:"spider",title:"Spider",limitCycles:1,deckConfig:{decks:8,suits:"S"},stackConfig:[{empty:"",match:[{suit:!0,count:13,rank:m.Desc}],limitVisible:1,complete:{count:13},matchPriority:2},{deal:1,canPut:!0,init:6,facedown:5,limitAvailable:0,match:{suit:!0,rank:m.Desc},limitVisible:20},{deal:1,canPut:!0,init:5,facedown:4,limitAvailable:0,match:{suit:!0,rank:m.Desc},limitVisible:20}],layout:"D 00000000,1111222222"}),D(Object.assign({},O.spider,{name:"spider-two-suit",family:"spider",title:"Two suits",deckConfig:{decks:4,suits:"SD"}}));class E{constructor(t,i,s){return this.cardDepth=t,this.fromStack=i,this.toStack=s,this}toString(){return this.toStack?`${this.fromStack}->${this.toStack}${this.cardDepth>1?`(${this.cardDepth})`:""}`:`${this.fromStack}[#${this.cardDepth}]`}reverse(){return this.toStack||0===this.toStack?new E(this.cardDepth,this.toStack,this.fromStack):new E(this.cardDepth,this.fromStack)}}class P{constructor(t,i){return this.type=t,this.actions=Array.isArray(i)?i:[i],this}toString(){return`${this.type} (${this.actions.join(",")})`}reverse(){let t=new P(this.type,this.actions.map((t=>t.reverse())));return t.actions.reverse(),t}}class T{constructor(t){if(this.name="",this.family="",this.centerRows=!0,this.overlayRows=!1,this.multiSelect=!1,this.selectBlockedStacks=!0,this.showEmpty=!0,this.limitCycles=0,this.limitUndo=0,this.layout="",this.footer="",t)if("string"==typeof t&&O[t]){let i=O[t];i.overlayRows&&!i.hasOwnProperty("selectBlockedStacks")&&(i.selectBlockedStacks=!1),Object.assign(this,i),this.deckConfig=new j(this.deckConfig),this.stackConfig=Array.isArray(this.stackConfig)?this.stackConfig.map((t=>new w(t))):[new w]}else if("string"==typeof t){let i=t.split("!");[this.centerRows,this.overlayRows,this.multiSelect,this.showEmpty,this.selectBlockedStacks]=o(i[0]),[this.limitCycles,this.limitUndo]=i[1].split("").map(l),this.deckConfig=new j(i[2]),this.stackConfig=i[3].split("|").map((t=>new w(t))),this.layout=i[4],this.footer=i[5]||""}else t.overlayRows&&!t.hasOwnProperty("selectBlockedStacks")&&(t.selectBlockedStacks=!1),Object.assign(this,t),this.deckConfig=new j(this.deckConfig),this.stackConfig.forEach((t=>new w(t)));else this.deckConfig=new j,this.stackConfig=[new w];return this}toString(){return[c(this.centerRows,this.overlayRows,this.multiSelect,this.showEmpty,this.selectBlockedStacks),h(this.limitCycles,this.limitUndo),this.deckConfig,this.stackConfig.join("|"),this.layout].join("!").replace(" ","+")}}class V{constructor(t,i){this.name="",this.stacks=[],this.undo=[],this.redo=[],this.layout=[],this.footer=[],this.longestRow=0,this.conf=new T(t),this.name=this.conf.name||"",this.deck=new x(i||this.conf.deckConfig),["layout","footer"].forEach((t=>{let i=this.conf[t].split(",").map((i=>{let s=0,e=i.split("").map((t=>{let i;return t.match(/\d/)?(i=new A(this.conf.stackConfig[t]),i.index=this.stacks.length,this.stacks.push(i),i.maxHeight>s&&(s=i.maxHeight)):t.match(/[Dd]/)?i=this.deck:t.match(/[-_]/)&&(i=t),i}));return"layout"===t&&e.length>this.longestRow&&(this.longestRow=e.length),{maxHeight:s,stacks:e}}));this[t]=i}));let s=this.stacks.filter((t=>t.conf.isFreecell));this.stacks.forEach((t=>{t.conf.isFreecell||(t.freecellStacks=s)})),this.layout.forEach((t=>{t.stacks.forEach(((i,s)=>{i&&"string"!=typeof i&&(i.rowPosition=2*s+1,this.conf.centerRows&&(i.rowPosition+=this.longestRow-t.stacks.length))}))}));for(let e=0;e<this.layout.length-1;e++){let t=this.layout[e],i=this.layout[e+1];t.stacks.forEach(((t,s)=>{t&&"string"!=typeof t&&!t.isDeck&&i.stacks.filter((i=>i&&"string"!=typeof i&&i.rowPosition&&i.rowPosition>t.rowPosition-2&&i.rowPosition<t.rowPosition+2)).forEach((i=>{i&&"string"!=typeof i&&(t.stacksOverlaying.push(i),i.stacksOverlayed.push(t))}))}))}return this.initialize(),this}get canRecycle(){return!this.conf.limitCycles||this.conf.limitCycles-this.deck.cycles}initialize(){this.deck.reset(),this.stacks.forEach((t=>t.reset())),this.undo=[],this.redo=[],this.selection=[];let t=this.deck.length;do{t=this.deck.length,this.deal(!1)}while(this.deck.length!==t);this.deck.initialized=!0,this.stacks.forEach((t=>{if(t.initialized=!0,t.length&&t.conf.facedown)for(let i=0;i<t.conf.facedown;i++)t.stack[i].facedown=!0}))}reset(){this.deck.reset(),this.initialize()}new(){this.deck.shuffle(),this.initialize()}getStack(t){return this.stacks[t]||this.deck}doUndo(){if(!this.undo.length)return;let t=this.undo.pop();this.redo.push(t),this.do(t.reverse(),!0)}doRedo(){if(!this.redo.length)return;let t=this.redo.pop();this.undo.push(t),this.do(t,!0)}do(t,i=!1){i||(this.setUndo(t),this.redo=[]),"flip"===t.type?t.actions.forEach((t=>{this.getStack(t.fromStack).getCard(t.cardDepth).flip()})):(t.actions.forEach((t=>{this.getStack(t.toStack).push(this.getStack(t.fromStack).pull(t.cardDepth))})),"recycle"===t.type&&(this.deck.cycles+=-1===t.actions[0].toStack?1:-1))}setUndo(t){this.conf.limitUndo>=0&&(this.undo.push(t),this.conf.limitUndo&&this.undo.length>this.conf.limitUndo&&this.undo.shift())}stacksWant(t){return this.stacks.filter((i=>i.wants(t))).sort(((t,i)=>i.conf.matchPriority-t.conf.matchPriority))}deal(t=!0){this.deck.initialized?this.deck.isEmpty?this.canRecycle&&this.do(new P("recycle",this.stacks.map((t=>{if(t.conf.deal)return new E(t.length,t.index,this.deck.index)})).filter(Boolean))):this.do(new P("deal",this.stacks.map((t=>{if(!this.deck.isEmpty&&t.conf.deal)return new E(parseInt(t.conf.deal.toString())||1,this.deck.index,t.index)})).filter(Boolean))):this.stacks.forEach((t=>{t.conf.init>t.stack.length&&t.push(this.deck.pull())})),this.selection=[]}clickCard(t,i){let s="number"==typeof i?this.getStack(i):i,e=s.getCardDepth(t),a=s.getCard(e);if(!(s.conf.limitAvailable&&e>s.conf.limitAvailable)&&!s.conf.discard&&(this.conf.selectBlockedStacks||!s.isBlocked)&&!(e>1&&a.facedown))if(a.facedown)this.do(new P("flip",new E(e,s.index)));else if(this.conf.multiSelect){let t=s.look(e);if(this.selection.find((t=>t.stackIndex===s.index&&t.cardDepth>=e))?this.removeSelected(s.index):this.setSelected(t,s),this.selection.length){let t=this.stacksWant(this.selection);if(t.length){let i=this.selection.reduce(((i,s,e,a)=>(i.find((t=>t.fromStack===s.stackIndex))||i.push(new E(a.filter((t=>t.stackIndex===s.stackIndex)).length,s.stackIndex,t[0].index)),i)),[]);this.selection=[],this.do(new P("move",i))}}}else{let t=s.look(e);this.setSelected(t,s);let i=this.stacksWant(this.selection);i.length&&this.do(new P("move",new E(e,s.index,i[0].index))),this.removeSelected(s.index)}}clearSelected(){this.selection=[]}removeSelected(t){this.selection=this.selection.filter((i=>i.stackIndex!==t))}setSelected(t,i){let s=t.map(((s,e)=>new v(s,t.length-e,i.index)));this.removeSelected(i.index),this.selection=[...this.selection,...s]}}export{P as A,V as G,E as a,O as g};
